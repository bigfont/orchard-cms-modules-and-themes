@using System.Globalization;
@using System.Collections;
@using Orchard.UI.Navigation;

@{
    var item = Model.MenuItem as MenuItem;
    
    // Use the href as the link text,
    // if it's the top level menu item,
    // because we want the subnav title to be different than the link
    // While this is a bit odd, that is what the original site does, so we're doing it here too.
    var textInfo = new CultureInfo("en-US", false).TextInfo;    
    var text = Model.IsTopLevel ?
        textInfo.ToTitleCase(item.Href.Substring(1)).Replace('-', ' ') :
        item.Text.Text;
    var href = item.Href;
    
    // the section menu requires that *some* child items are rendered as sibling items
    // which means that if a child is selected, then two siblings can *appear* to be selected
    // prevent this as follows
    if (item.Items.Any(i => i.Selected))
    {
        item.Selected = false;
    }    
    var attr = new { @class = item.Selected ? "active" : "" };
    
    // render the beast
    var tag = Tag(Model, "li");
    @tag.StartElement

    @Html.Link(text, href, attr)

    @tag.EndElement
}